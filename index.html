<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>ä¸€ç·’ã«ãŠæ‰‹ç´™</title>
  <link href="chat_kadai.css" rel="stylesheet" type="text/css" media="all">

</head>
<body>

<!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->
<h1>ä¸€ç·’ã«ãŠæ‰‹ç´™ã‚’æ›¸ã“ã†</h1>

<id="write-letter-section">
  <h2>ãŠæ‰‹ç´™ã‚’æ›¸ã</h2>
  <p>
  <input type="text" id="nameInput" placeholder="åå‰">
  </p>

  <textarea id="messageInput" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æœ¬æ–‡"></textarea>
  <input type="color" id="colorPicker" value="#000000">
  
  <p>
  <button id="send">æŠ•ç¨¿ã™ã‚‹</button>
  </p>

</div>

<div id="letters-section">
  <h2>ãŠæ‰‹ç´™ã‚¨ãƒªã‚¢</h2>
  <div id="letterContainer"></div>
</div>

<div id="output" style="overflow: auto;height: 300px;"></div>


<!--/ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->


<!-- JQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<!-- JQuery -->


<!--** ä»¥ä¸‹Firebase **-->

<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
  import { getDatabase, ref, push, set, update, remove, onChildAdded, onChildChanged, onChildRemoved }
  from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";
  
  // Your web app's Firebase configuration
  const firebaseConfig = {
      apiKey: "Your API Key",
      authDomain: "Your Auth Domain",
      projectId: "Your Project ID",
      storageBucket: "Your Storage Bucket",
      messagingSenderId: "Your Messaging Sender ID",
      appId: "Your App ID"
  };
  
  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const dbRef = ref(db, "chat");


    // é€ä¿¡
    $("#send").on("click",function(){
      const msg ={
        uname: $("#nameInput").val(), 
        text : $("#messageInput").val(),
        color : $("#colorPicker").val(),
        timestamp: firebase.database.ServerValue.TIMESTAMP
      }
      const newPostRef = push(dbRef); //ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼ã‚’ç”Ÿæˆã€pushã§ãã‚‹çŠ¶æ³ã‚’ä½œã£ã¦
      // console.log(newPostRef);
      set(newPostRef,msg);ã€€//DBã«å€¤ã‚’ã‚»ãƒƒãƒˆã™ã‚‹

    });


    //æœ€åˆã«ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼†onSnapchotã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    onChildAdded(dbRef, function(data) {
      const msg = data.val();//ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå¤‰æ•°
      const key = data.key; //ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼ã€€ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤æ›´æ–°ã«å¿…è¦
      const timestamp = new Date(msg.timestamp);
      let h = '<p id="'+key+'">';
          h += msg.uname;
          h += '<br>';
          h += '<span contentEditable="true" id="'+key+'_update">'+msg.text+'</span>';
          h += '<span class="remove" data-key="'+key+'">ğŸ—‘ï¸</span>'
          h += '<span class="update" data-key="'+key+'">ğŸ†™</span>'
          h += '<br>æŠ•ç¨¿æ—¥æ™‚: ' + timestamp.toLocaleString(); 
          // h += msg.text;
          h += '</p>';
          $("#output").prepend(h);
    });

      //å‰Šé™¤ã‚¤ãƒ™ãƒ³ãƒˆ
     $("#output").on("click",".remove",function(){
      const key = $(this).attr("data-key"); //thisã€€ã“ã“ã ã‘
      const remove_item = ref(db,"chat/"+key);
      remove(remove_item); //Firebaceãƒ‡ãƒ¼ã‚¿å‰Šé™¤é–¢æ•°      
     });

     //æ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆ
     $("#output").on("click",".update",function(){
      const key = $(this).attr("data-key");
      update (ref(db,"chat/"+key),{
              text: $("#"+key+'_update').html()
         });
    });

  </script>




</body>
</html>
































